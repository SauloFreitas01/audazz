# üîí AUDAZZ - AUTOMATED DAST

Framework para automa√ß√£o de testes de seguran√ßa usando OWASP ZAP via linha de comando e API, sem necessidade de interface gr√°fica.

## üìã √çndice

- [Caracter√≠sticas](#caracter√≠sticas)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Instala√ß√£o](#instala√ß√£o)
- [Configura√ß√£o](#configura√ß√£o)
- [Uso B√°sico](#uso-b√°sico)
- [Tipos de Varredura](#tipos-de-varredura)
- [Configura√ß√µes Avan√ßadas](#configura√ß√µes-avan√ßadas)
- [Integra√ß√£o CI/CD](#integra√ß√£o-cicd)
- [Monitoramento e Relat√≥rios](#monitoramento-e-relat√≥rios)
- [Troubleshooting](#troubleshooting)

## ‚ú® Caracter√≠sticas

- üöÄ **Automa√ß√£o Completa**: Execu√ß√£o via linha de comando sem interface gr√°fica
- üéØ **M√∫ltiplos Tipos**: Suporte para SPAs, APIs REST, GraphQL, aplica√ß√µes tradicionais
- üîß **Configur√°vel**: Pol√≠ticas customizadas para reduzir falsos positivos
- üìä **Relat√≥rios**: M√∫ltiplos formatos (JSON, HTML, XML) para integra√ß√£o
- üê≥ **Containerizado**: Execu√ß√£o via Docker com Selenium Grid para SPAs
- üîÑ **CI/CD Ready**: Integra√ß√£o f√°cil com pipelines de deployment
- üìà **M√©tricas**: Processamento para Grafana e sistemas de monitoramento

## üõ† Pr√©-requisitos

### B√°sico
- Docker 20.10+
- Docker Compose 2.0+
- Python 3.8+ (para processamento de relat√≥rios)

### Para SPAs com Selenium
- 4GB+ de RAM dispon√≠vel
- Rede Docker configurada

### Para integra√ß√£o CI/CD
- Jenkins, GitLab CI, GitHub Actions, ou similar
- Acesso ao registry Docker

## üì¶ Instala√ß√£o

### 1. Clone o reposit√≥rio
```bash
git clone <repository-url>
cd owasp-zap-automation
```

### 2. Torne o script execut√°vel
```bash
chmod +x run_zap_automation.sh
```

### 3. Verificar Docker
```bash
docker --version
docker-compose --version
```

### 4. Pull das imagens necess√°rias
```bash
docker pull owasp/zap2docker-stable:2.14.0
docker pull selenium/hub:4.15.0-20231129
docker pull selenium/node-chrome:4.15.0-20231129
```

## ‚öôÔ∏è Configura√ß√£o

### Estrutura de Arquivos
```
owasp-zap-automation/
‚îú‚îÄ‚îÄ zap_automation_plan.yaml          # Configura√ß√£o principal
‚îú‚îÄ‚îÄ zap_spa_automation.yaml           # Configura√ß√£o para SPAs
‚îú‚îÄ‚îÄ zap_policy_config.yaml            # Pol√≠ticas otimizadas
‚îú‚îÄ‚îÄ run_zap_automation.sh             # Script principal
‚îú‚îÄ‚îÄ docker-compose.yaml               # Orquestra√ß√£o Docker
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îî‚îÄ‚îÄ zap_application_examples.yaml # Exemplos por tipo de app
‚îú‚îÄ‚îÄ reports/                          # Relat√≥rios gerados
‚îú‚îÄ‚îÄ config/                           # Configura√ß√µes extras
‚îî‚îÄ‚îÄ grafana/                          # Dashboards Grafana
```

### Vari√°veis de Ambiente

#### Obrigat√≥rias
```bash
export TARGET_URL="https://example.com"
```

#### Opcionais
```bash
export ZAP_VERSION="2.14.0"
export AUTH_USER="testuser"
export AUTH_PASS="testpass"
export LOGIN_URL="https://example.com/login"
export SPA_BASE_URL="https://app.example.com"
export API_BASE_URL="https://api.example.com"
export SELENIUM_GRID_URL="http://selenium-hub:4444/wd/hub"
```

## üöÄ Uso B√°sico

### Varredura Padr√£o
```bash
TARGET_URL=https://example.com ./run_zap_automation.sh standard
```

### Varredura SPA (React/Angular/Vue)
```bash
TARGET_URL=https://app.example.com ./run_zap_automation.sh spa
```

### Varredura R√°pida (CI/CD)
```bash
TARGET_URL=https://staging.example.com ./run_zap_automation.sh quick
```

### Com Autentica√ß√£o
```bash
TARGET_URL=https://example.com \
AUTH_USER=testuser \
AUTH_PASS=testpass \
LOGIN_URL=https://example.com/login \
./run_zap_automation.sh standard
```

## üéØ Tipos de Varredura

### 1. Standard Scan
Varredura completa para aplica√ß√µes web tradicionais.

**Caracter√≠sticas:**
- Spider tradicional
- Passive scan
- Active scan com pol√≠ticas otimizadas
- Relat√≥rios em m√∫ltiplos formatos

**Dura√ß√£o:** 20-45 minutos

### 2. SPA Scan
Otimizada para Single Page Applications.

**Caracter√≠sticas:**
- AJAX Spider com Selenium
- Detec√ß√£o de DOM XSS
- Configura√ß√µes espec√≠ficas para SPAs
- Integra√ß√£o com Selenium Grid

**Dura√ß√£o:** 30-60 minutos

### 3. Quick Scan
Varredura r√°pida para CI/CD.

**Caracter√≠sticas:**
- Baseline scan do ZAP
- Foco em vulnerabilidades cr√≠ticas
- Timeout reduzido
- Relat√≥rio simplificado

**Dura√ß√£o:** 5-15 minutos

### 4. API Scan
Espec√≠fica para APIs REST/GraphQL.

**Caracter√≠sticas:**
- Import de especifica√ß√µes OpenAPI
- Testes espec√≠ficos para APIs
- Autentica√ß√£o via Bearer Token
- Valida√ß√£o de CORS

**Dura√ß√£o:** 15-30 minutos

## üîß Configura√ß√µes Avan√ßadas

### Personalizar Pol√≠ticas de Varredura

Edite `zap_policy_config.yaml` para:

1. **Desabilitar regras** que geram falsos positivos
2. **Ajustar thresholds** (LOW, MEDIUM, HIGH)
3. **Configurar strength** (LOW, MEDIUM, HIGH)
4. **Definir timeouts** por regra

Exemplo:
```yaml
disabledRules:
  - id: "10096"
    name: "Timestamp Disclosure"
    reason: "Falsos positivos frequentes"

ruleConfigs:
  - id: "40018" # SQL Injection
    threshold: "HIGH"
    strength: "HIGH"
```

### Configurar para Diferentes Ambientes

```bash
# Desenvolvimento - Mais agressivo
ENVIRONMENT=development ./run_zap_automation.sh standard

# Produ√ß√£o - Mais conservador
ENVIRONMENT=production ./run_zap_automation.sh quick
```

### Usar Docker Compose

#### SPA com Selenium Grid
```bash
TARGET_URL=https://app.example.com \
docker-compose --profile zap-with-grid up
```

#### Com Monitoramento
```bash
TARGET_URL=https://example.com \
docker-compose --profile zap-only --profile monitoring up
```

## üîÑ Integra√ß√£o CI/CD

### Jenkins Pipeline
```groovy
pipeline {
    agent any
    
    environment {
        TARGET_URL = "${params.TARGET_URL}"
        ZAP_VERSION = "2.14.0"
    }
    
    stages {
        stage('Security Scan') {
            steps {
                script {
                    sh '''
                        chmod +x run_zap_automation.sh
                        ./run_zap_automation.sh quick
                    '''
                }
            }
        }
        
        stage('Process Results') {
            steps {
                script {
                    // Publicar relat√≥rios
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: 'reports',
                        reportFiles: '*.html',
                        reportName: 'ZAP Security Report'
                    ])
                    
                    // Processar m√©tricas
                    sh './run_zap_automation.sh process-reports'
                }
            }
        }
    }
    
    post {
        always {
            archiveArtifacts artifacts: 'reports/**/*', fingerprint: true
        }
    }
}
```

### GitHub Actions
```yaml
name: Security Scan

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Run ZAP Security Scan
      env:
        TARGET_URL: ${{ secrets.TARGET_URL }}
      run: |
        chmod +x run_zap_automation.sh
        ./run_zap_automation.sh quick
    
    - name: Upload Reports
      uses: actions/upload-artifact@v3
      with:
        name: zap-reports
        path: reports/
```

### GitLab CI
```yaml
variables:
  ZAP_VERSION: "2.14.0"

security_scan:
  stage: test
  image: docker:latest
  services:
    - docker:dind
  script:
    - chmod +x run_zap_automation.sh
    - TARGET_URL=$STAGING_URL ./run_zap_automation.sh quick
  artifacts:
    reports:
      junit: reports/*.xml
    paths:
      - reports/
    expire_in: 1 week
  only:
    - merge_requests
    - main
```

## üìä Monitoramento e Relat√≥rios

### Integra√ß√£o com Grafana

1. **Iniciar stack de monitoramento:**
```bash
docker-compose --profile monitoring up -d
```

2. **Acessar Grafana:** http://localhost:3000
   - Usu√°rio: admin
   - Senha: admin123

3. **Processar m√©tricas:**
```bash
./run_zap_automation.sh process-reports
```

### M√©tricas Dispon√≠veis

- Total de vulnerabilidades por criticidade
- Tend√™ncias de seguran√ßa ao longo do tempo
- Compara√ß√£o entre ambientes
- Time to remediation
- Cobertura de testes

### Alertas Customizados

Configure alertas no Grafana para:
- Vulnerabilidades cr√≠ticas detectadas
- Aumento significativo de alertas
- Falhas no processo de scan

## üêõ Troubleshooting

### Problemas Comuns

#### 1. "Target URL n√£o acess√≠vel"
```bash
# Verificar conectividade
curl -I $TARGET_URL

# Verificar DNS
nslookup $(echo $TARGET_URL | sed 's|https\?://||' | cut -d'/' -f1)
```

#### 2. "Selenium Grid n√£o responde"
```bash
# Verificar status do grid
docker logs selenium-hub

# Restart do grid
./run_zap_automation.sh cleanup-selenium
./run_zap_automation.sh setup-selenium
```

#### 3. "Mem√≥ria insuficiente"
```bash
# Verificar uso de mem√≥ria
docker stats

# Aumentar limites no docker-compose.yaml
environment:
  - JAVA_OPTS=-Xmx4g
```

#### 4. "Falha na autentica√ß√£o"
```bash
# Testar autentica√ß√£o manualmente
curl -X POST $LOGIN_URL \
  -d "username=$AUTH_USER&password=$AUTH_PASS" \
  -v
```

### Debug Mode

Execute com debug habilitado:
```bash
DEBUG=true TARGET_URL=https://example.com ./run_zap_automation.sh standard
```

### Logs Detalhados

Verificar logs do container:
```bash
docker logs owasp-zap-automation
```

### Performance Tuning

Para ambientes com recursos limitados:

1. **Reduzir paralelismo:**
```yaml
parameters:
  threadPerHost: 1
  maxDuration: 15
```

2. **Limitar regras ativas:**
```yaml
disabledRules:
  - "10096"  # Timestamp
  - "10094"  # Base64
  - "10049"  # Content Cacheability
```

3. **Configurar timeouts:**
```yaml
performanceOptimization:
  maxScanTimePerRule: 180
  maxRequestsPerRule: 50
```

## üìù Exemplos Pr√°ticos

### E-commerce
```bash
TARGET_URL=https://shop.example.com \
AUTH_USER=customer@example.com \
AUTH_PASS=password123 \
./run_zap_automation.sh standard
```

### API REST
```bash
TARGET_URL=https://api.example.com \
API_TOKEN=bearer_token_here \
./run_zap_automation.sh standard rest_api_config.yaml
```

### WordPress
```bash
TARGET_URL=https://blog.example.com \
AUTH_USER=wpuser \
AUTH_PASS=wppass \
./run_zap_automation.sh standard wordpress_config.yaml
```

## ü§ù Contribuindo

1. Fork o projeto
2. Crie uma branch para sua feature
3. Commit suas mudan√ßas
4. Push para a branch
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para detalhes.

## üîó Links √öteis

- [OWASP ZAP Documentation](https://www.zaproxy.org/docs/)
- [ZAP Automation Framework](https://www.zaproxy.org/docs/automate/automation-framework/)
- [OWASP Top 10](https://owasp.org/Top10/)
- [ZAP Docker Images](https://hub.docker.com/r/owasp/zap2docker-stable)
- [Selenium Grid Documentation](https://selenium-python.readthedocs.io/)